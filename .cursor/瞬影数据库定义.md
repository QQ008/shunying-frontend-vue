# 主后台数据库

数据库：**PostgreSQL**

## 关系图：

## 表清单：

| / | 数据表 | 名称 | 备注 |
| --- | --- | --- | --- |
| 1 | WORKERS | 工作人员信息 | √ |
| 2 | EVENTS | 赛事/活动信息 | √ |
| 3 | EVENT_GROUPS | 赛事/活动组别信息 | √ |
| 4 | LOCATION | 地点信息 | √ |
| 5 | IMAGE_GROUPS | 图片组信息 |  |
| 6 | IMAGES | 单张图片信息 |  |
| 7 | IMAGE_GROUP_REL | 图片与图片组关系 |  |
| 8 | IMAGE_POST_SERVICE | 后期处理服务 |  |
| 9 | IMAGE_SERVICE_REL | 后期处理服务与图片关联 |  |
| 10 | IMAGE_SALES | 图片销售/定价信息 | 改 |
| 11 | DISCOUNT_POLICY | 折扣策略 | 改/删 |
| 12 | POLICY_IMAGE | 折扣策略与图片关联 | 改/删 |
| 13 | POLICY_USER_GROUP | 策略与用户分组关联 | 改/删 |
| 14 | USER_GROUP | 用户分组/会员等级 | 改 |
| 15 | USER_GROUP_REL | 用户与分组关联 |  |
| 16 | COUPONS | 优惠券信息 | 改/删 |
| 17 | USER_COUPONS | 用户优惠券 | 改/删 |
| 18 | USER | 用户信息 | √ |
| 19 | USER_WECHAT_BINDINGS | 用户微信绑定信息 | √ |
| 20 | REFRESH_TOKENS | 令牌刷新信息 | √ |
| 21 | USER_POINTS_LOG | 用户积分流水 | √ |
| 22 | CART_ITEMS | 用户购物车条目 | √ |
| 23 | USER_FAVORITES | 用户收藏 | √ |
| 24 | USER_BROWSING_HISTORY | 用户浏览历史记录 | √ |
| 25 | USER_BEHAVIOR  | 用户行为信息收集 | √ |
| 26 | ORDERS | 订单信息 |  |
| 27 | ORDER_ITEMS | 订单条目信息 | 待补全 |
| 28 |  | 订单优惠明细表 | 待补全 |
| 29 | NOTIFICATIONS | 通知消息 |  |
| 30 | USER_NOTIFICATION_REL | 用户与通知关联 |  |
| 31 | REPORTS | 举报信息 |  |
| 32 | FEEDBACK | 反馈信息 |  |
| 33 | SHOOTING_PREVIEWS | 拍摄预告 |  |
| 34 | PHOTOGRAPHER_PORTFOLIO_REL | 摄影师作品关联表 |  |
| 35 | USER_SETTINGS | 用户个性化配置 |  |
| 36 | ARTICLES | 图文信息 |  |
| 37 | PHOTOGRAPHER_EARNINGS | 摄影师收益流水 |  |
| 38 | PAYOUTS | 提现记录 |  |
| 39 | ACTION_LOGS | 操作日志 |  |
| 40 | ERROR_LOGS | 错误日志 |  |
| 41 | LOGIN_LOGS | 登录日志 |  |
| 42 | API_LOGS | 接口请求日志 |  |
| 43 | OPERATION_AUDIT | 字段级变更审计日志 |  |
| 44 | SMS_LOGS | 短信/验证码发送日志 |  |
| 45 | TASK_EXECUTION_LOGS | 定时任务执行日志 |  |
| 46 | ORDER_LOGS | 订单操作日志 |  |
| 47 | SYSTEM_CONFIG | 系统配置表 |  |
| 48 | IMAGE_EXIF | 图片其他exif信息表 | 待设计 |
| 49 | WORKER_DETAIL | 工作人员详细信息 | 待设计 |
| 50 | EVENT_IMAGE_EXTRA  | 赛事图片额外信息表 | 待设计 |
| 51 | CONVERSATIONS | 客服会话表 | 待设计 |
|  | MESSAGES | 客服消息表 | 待设计 |

## 表字段明细

### **WORKERS [工作人员信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY_KEY | √ |  | 使用 BIGSERIAL 自动增长 |
| 2 | user_id | 关联用户ID | BIGINT | INDEX, FK -> users(id) |  | NULL | 如果工作人员也是平台用户，关联用户表ID |
| 3 | position | 职位 | VARCHAR(64) | INDEX(position) |  | NULL | 如摄影师、管理员等 |
| 4 | nickname | 昵称 | VARCHAR(64) |  |  | NULL |  |
| 5 | organization | 所属组织/公司/账号 | VARCHAR(128) |  |  | NULL |  |
| 6 | avatar_path | 头像存储路径 | VARCHAR(255) |  |  | NULL |  |
| 7 | real_name | 真实姓名(或备注名) | VARCHAR(64) |  |  | NULL |  |
| 8 | remark | 备注 | VARCHAR(255) |  |  | NULL |  |
| 9 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳 |
| 10 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳, 自动更新触发器 |
| 11 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已删除，false 表示正常 |

### **EVENTS[赛事/活动信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | event_name | 活动名称 | VARCHAR(255) |  | √ |  |  |
| 3 | event_desc | 活动描述 | TEXT |  |  | NULL |  |
| 4 | event_type | 活动类型 | SMALLINT | INDEX |  | NULL | 使用 SMALLINT (0=赛事, 1=活动) |
| 5 | organizer | 主办方名称 | VARCHAR(255) |  |  | NULL |  |
| 6 | event_date | 举办日期 | DATE | INDEX |  | NULL |  |
| 7 | start_time | 开始时间 | TIMESTAMPTZ | CHECK(start_time < end_time) |  | NULL | 使用带时区的时间戳 |
| 8 | end_time | 结束时间 | TIMESTAMPTZ |  |  | NULL | 使用带时区的时间戳 |
| 9 | location_id | 赛事地点 ID | BIGINT | INDEX, FK -> location(id) |  | NULL | 外键关联 location 表, 地点删除时置 NULL |
| 10 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳 |
| 11 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳, 自动更新触发器 |
| 12 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已删除，false 表示正常 |

### **EVENT_GROUPS[赛事/活动组别信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | event_id | 赛事/活动 ID | BIGINT | INDEX, FK -> events(id) | √ |  | 外键关联 events 表, 赛事删除时级联删除 |
| 3 | group_name | 组别名称 | VARCHAR(64) | UNIQUE INDEX (group_name) | √ |  |  |
| 4 | group_desc | 组别描述 | TEXT | Part of UNIQUE (event_id, group_name) |  | NULL |  |
| 5 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳 |
| 6 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳, 自动更新触发器 |
| 7 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已删除，false 表示正常 |

### **LOCATION[地点信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | province | 省份 | VARCHAR(64) | INDEX |  | NULL |  |
| 3 | city | 城市 | VARCHAR(64) | INDEX |  | NULL |  |
| 4 | district | 辖区/县 | VARCHAR(64) | INDEX |  | NULL |  |
| 5 | address | 具体地点名称 | VARCHAR(255) |  |  | NULL |  |
| 6 | lat | 纬度 | NUMERIC(10, 6) | INDEX (与lng组合) |  | NULL |  |
| 7 | lng | 经度 | NUMERIC(10, 6) | INDEX (与lat组合) |  | NULL |  |
| 8 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳 |
| 9 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 使用带时区的时间戳, 自动更新触发器 |
| 10 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已删除，false 表示正常 |

### **IMAGE_GROUPS[图片组信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | shoot_time | 拍摄时间 | DATETIME | INDEX(shoot_time) |  |  |  |
| 3 | location_id | 地点 | INT | INDEX(location_id) |  |  | 外键 -> LOCATION(id) |
| 4 | photographer_id | 摄影师 | INT | INDEX(photographer_id) |  |  | 外键 -> WORKERS(id) |
| 5 | post_processor_id | 后期 | INT |  |  |  | 外键 -> WORKERS(id) |
| 6 | event_id | 赛事/活动 | INT | INDEX(event_id) |  |  | 外键 -> EVENTS(id) |
| 7 | event_group_id | 组别 | INT |  |  |  | 外键 -> EVENT_GROUPS(id) |
| 8 | cover_image_path | 封面图路径 | VARCHAR(255) |  |  |  |  |
| 9 | tags | 标签 | VARCHAR(255) |  |  |  | 标签(如[精选,官方])，可存JSON或逗号分隔 |
| 10 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 11 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 12 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **IMAGES[单张图片信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | original_path | 原图路径 | VARCHAR(255) |  | √ |  |  |
| 3 | preview_path | 预览图路径 | VARCHAR(255) |  | √ |  |  |
| 4 | cover_path | 封面图路径 | VARCHAR(255) |  |  |  |  |
| 5 | audit_status | 审核状态 | TINYINT | INDEX(audit_status) | √ | 0 | 0=待审核,1=审核通过,2=审核驳回(示例) |
| 6 | audit_remark | 审核备注 | VARCHAR(255) |  |  |  | 记录审核人员的意见、拒绝理由等 |
| 7 | shoot_time | 拍摄时间 | DATETIME |  |  |  |  |
| 8 | location_id | 地点 | INT |  |  |  | 外键 -> LOCATION(id) |
| 9 | jersey_color | 骑行服颜色 | VARCHAR(32) | INDEX(jersey_color) |  |  | 如"红","蓝","黑"等，也可做枚举表或统一色值策略 |
| 10 | pants_color | 骑行裤颜色 | VARCHAR(32) | INDEX(pants_color) |  |  | 同上 |
| 11 | shoe_color | 鞋子颜色 | VARCHAR(32) | INDEX(shoe_color) |  |  | 同上 |
| 12 | bike_type | 车型 | VARCHAR(32) | INDEX(bike_type) |  |  | 例如 "公路车","摩托车","其他” |
| 13 | original_resolution | 原图清晰度 | VARCHAR(32) |  |  |  | 如1920X1080 |
| 14 | preview_resolution | 预览图清晰度 | VARCHAR(32) |  |  |  | 同上 |
| 15 | camera_model | 相机型号 | VARCHAR(128) |  |  |  | 相机型号 |
| 16 | lens_model | 镜头型号 | VARCHAR(128) |  |  |  | 镜头型号 |
| 17 | shutter_speed | 快门速度 | VARCHAR(32) |  |  |  |  |
| 18 | aperture | 光圈值 | VARCHAR(32) |  |  |  |  |
| 19 | iso | 感光度 | VARCHAR(32) |  |  |  |  |
| 20 | ev | EV值 | VARCHAR(32) |  |  |  |  |
| 21 | white_balance | 白平衡 | VARCHAR(32) |  |  |  |  |
| 22 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 23 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 24 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **IMAGE_GROUP_REL[图片与图片组关系]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | image_id | 图片id | INT | PRIMARY KEY(image_id, image_group_id) | √ |  |  |
| 2 | image_group_id | 图片组id | INT | PRIMARY KEY(image_id, image_group_id) | √ |  |  |
| 3 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 4 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 5 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **IMAGE_POST_SERVICE[后期处理服务]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | service_name | 服务名称 | VARCHAR(64) |  |  |  | 如"精修","去水印","换背景","人像美化"等 |
| 3 | service_desc | 服务描述 | VARCHAR(255) |  |  |  |  |
| 4 | base_price | 基础价格 | DECIMAL(10,2) |  |  | 0.00 | 可选：表示该服务的基础费用(若有定价) |
| 5 | remark | 备注 | VARCHAR(255) |  |  |  |  |
| 6 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 7 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 8 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **IMAGE_SERVICE_REL[后期处理服务与图片关联]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  | 主键 |
| 2 | image_id | 图片ID | INT | INDEX(image_id) + UNIQUE KEY(image_id, service_id, is_deleted) |  |  | 外键 -> IMAGES(id)，与`service_id`建立唯一组合索引 |
| 3 | service_id | 后期服务ID | INT | INDEX(service_id) + UNIQUE KEY(image_id, service_id, is_deleted) |  |  | 外键 -> IMAGE_POST_SERVICE(id) |
| 4 | custom_price | 服务价格 | DECIMAL(10,2) |  |  |  | 针对本图片的自定义服务价 |
| 5 | remark | 备注 | VARCHAR(255) |  |  |  |  |
| 6 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 7 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 8 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **IMAGE_SALES[图片销售/定价信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | image_id | 图片id | INT | UNIQUE INDEX (image_id) | √ |  | 外键 -> IMAGES(id) |
| 3 | base_price | 基础销售价 | DECIMAL(10,2) |  |  | 0.00 | 原价 |
| 4 | discount_price | 统一折扣价 | DECIMAL(10,2) |  |  | 0.00 | 全局统一折扣价，可为空，或存“折扣率” |
| 5 | point_discount_type | 积分计算方式 | TINYINT |  |  |  | 0=百分比, 1=金额 |
| 6 | max_point_discount | 积分可抵数值 | DECIMAL(10,2) |  |  | 0.00 | (可选)积分兑换最大可抵扣金额 |
| 7 | currency | 币种 | VARCHAR(16) |  |  | 'CNY’ | (如 CNY, USD)，方便以后国际化 |
| 8 | start_time | 活动开始时间 | DATETIME | INDEX (start_time, end_time) |  |  | (可选)限时优惠开始时间 |
| 9 | end_time | 活动结束时间 | DATETIME |  |  |  | 同上 |
| 10 | remark | 备注 | VARCHAR(255) |  |  |  | 如促销信息说明等 |
| 11 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 12 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
|  | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **USER_GROUP[用户分组/会员等级]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | group_name | 用户组名称 | VARCHAR(64) | UNIQUE INDEX | √ |  | （如“VIP会员”） |
| 3 | description | 用户组描述 | VARCHAR(255) |  |  | NULL |  |
| 4 | base_discount_factor | 默认折扣因子 | NUMERIC(5,2) |  | √ | 1.00 | 如0.95表示享受95折优惠 (1.00 = 无折扣) |
| 5 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 6 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 7 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | FALSE=正常, TRUE=已删除 |

### **USER_GROUP_REL[用户与分组关联]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | user_id | 用户id | BIGINT | FK -> users(id) ON DELETE CASCADE | √ |  | 外键 -> users(id) |
| 2 | user_group_id | 用户组id | INTEGER | FK -> user_groups(id) ON DELETE CASCADE | √ |  | 外键 -> user_groups(id) |
| 3 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 4 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 5 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | FALSE=正常, TRUE=已删除 |
|  |  |  |  | PRIMARY KEY(user_id, user_group_id) |  |  | 复合主键 |

### **USER[用户信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | nickname | 昵称 | VARCHAR(128) |  |  | NULL |  |
| 3 | mobile_phone | 手机号 | VARCHAR(32) | UNIQUE INDEX (partial, where is_deleted=false) |  | NULL | 活跃用户的手机号唯一 |
| 4 | avatar | 头像 | VARCHAR(512) |  |  | NULL | 路径或URL |
| 5 | gender | 性别 | SMALLINT |  |  | NULL | 0=未知, 1=男, 2=女 |
| 6 | birth_date | 出生日期 | DATE |  |  | NULL |  |
| 7 | email | 邮箱 | VARCHAR(128) | UNIQUE INDEX (partial, where email IS NOT NULL and is_deleted=false) |  | NULL | 活跃用户的非空邮箱唯一 |
| 8 | points | 积分余额 | INTEGER |  | √ | 0 |  |
| 9 | real_name | 真实姓名 | VARCHAR(64) |  |  | NULL |  |
| 10 | id_number | 身份证号 | VARCHAR(32) | UNIQUE INDEX (partial, where id_number IS NOT NULL and is_deleted=false) |  | NULL | 活跃用户的非空身份证号唯一 |
| 11 | status | 账号状态 | SMALLINT | INDEX | √ | 0 | 0=正常, 1=封禁, 2=黑名单等 |
| 12 | source | 注册来源 | VARCHAR(64) |  |  | NULL | 如 'wechat', 'sms', 'admin_import' |
| 13 | last_login_time | 最后登录时间 | TIMESTAMPTZ |  |  | NULL |  |
| 14 | created_at | 创建时间 | TIMESTAMPTZ | INDEX | √ | CURRENT_TIMESTAMP |  |
| 15 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 16 | remark | 备注 | TEXT |  |  | NULL |  |
| 17 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已删除，false 表示正常 |

### **USER_WECHAT_BINDINGS[用户微信绑定信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 系统用户 ID | BIGINT | INDEX, FK -> users(id) | √ |  | 外键 -> USER(id) |
| 3 | app_id | 微信应用 ID | VARCHAR(64) | INDEX (与 openid 组合唯一) | √ |  | 区分公众号/小程序/网站应用等的AppID |
| 4 | unionid | 微信用户标识(跨应用) | VARCHAR(128) | INDEX (where unionid IS NOT NULL) |  | NULL | 同一微信开放平台下唯一标识  |
| 5 | unionid | 微信用户标识(跨应用) | VARCHAR(128) | INDEX(unionid, is_deleted) |  |  | 用户在同一开放平台账号下的唯一标识 (可选) |
| 6 | nickname | 微信昵称 | VARCHAR(128) |  |  | NULL | 授权时获取的微信昵称 (可选) |
| 7 | avatar_url | 微信头像 | VARCHAR(512) |  |  | NULL | 授权时获取的微信头像URL (可选) |
| 8 | created_at | 绑定时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 9 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 10 | is_deleted | 逻辑删除/解绑标记 | BOOLEAN | INDEX | √ | FALSE | false=已绑定, true=已解绑/删除 |

### **REFRESH_TOKENS[令牌刷新信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | INDEX, FK -> users(id) | √ |  | 外键 -> USER(id), 用户删除时级联删除令牌 |
| 3 | token | 刷新令牌 | TEXT | UNIQUE INDEX (partial, where is_deleted=false) | √ |  | 凭证本身, 活跃令牌唯一 |
| 4 | expires_at | 过期时间 | TIMESTAMPTZ | INDEX | √ |  | 刷新令牌的失效时间 |
| 5 | device_info | 设备信息 | VARCHAR(255) |  |  | NULL | 记录颁发令牌时的设备标识 (可选) |
| 6 | ip_address | IP 地址 | INET |  |  | NULL | 记录颁发令牌时的IP地址 (可选) |
| 7 | ast_used_at | 最后使用时间 | TIMESTAMPTZ |  |  | NULL | 记录此令牌最后一次被使用的时间 (可选) |
| 8 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 9 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 10 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已撤销/失效, false 表示有效 |
|  |  |  |  |  |  |  |  |

### **USER_POINTS_LOG[用户积分流水]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | INDEX, FK -> users(id) | √ |  | 外键 -> USER(id), 用户删除时级联删除流水 |
| 3 | change_amount | 本次积分变动值 | INTEGER |  | √ |  | （正数=增加，负数=减少） |
| 4 | change_type | 变动类型 | VARCHAR(32) | INDEX | √ |  | 如 purchase, exchange, event_bonus, admin_adjust 等 |
| 5 | source_id | 来源 ID | BIGINT | INDEX (with source_type) |  | NULL | 关联的业务对象 ID (如订单 ID、活动ID)，便于追踪 |
| 6 | source_type | 来源类型 | VARCHAR(32) | INDEX (with source_id) |  | NULL | 如 order, event, system |
| 7 | remark | 变动原因备注 | TEXT |  |  | NULL | 变动原因的文字说明 |
| 8 | expiry_time | 过期时间 | TIMESTAMPTZ |  |  | NULL | 积分过期时间 (NULL 表示永不过期) |
| 9 | current_balance | 变动后积分余额 | INTEGER |  | √ |  | 执行此次变动后的用户积分余额快照 |
| 10 | created_at | 创建时间 | TIMESTAMPTZ | INDEX | √ | CURRENT_TIMESTAMP | 流水记录创建时间 |
| 11 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 通常不变, 但保留以保持一致性 |
| 12 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | false=正常 (日志通常不软删, 除非有特殊业务需求) |
|  |  |  |  |  |  |  |  |

### **CART_ITEMS[用户购物车条目]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | INDEX (active), FK -> users(id), UNIQUE INDEX (active user item) |  | NULL | 外键 -> USER(id)，用户删除时级联删除购物车项. 活跃用户+商品类型+商品ID 唯一 |
| 3 | session_id | 会话 ID | VARCHAR(64) | INDEX (active), UNIQUE INDEX (active session item) |  | NULL | 关联匿名用户会话. 活跃会话+商品类型+商品ID 唯一 |
| 4 | item_type | 商品类型 | VARCHAR(32) | INDEX (with item_id) | √ |  | 如 'IMAGE', 'SERVICE', 用于区分 item_id 的含义 |
| 5 | item_id | 商品 ID | BIGINT | INDEX (with item_type) | √ |  | 对应 IMAGES(id) 或 IMAGE_POST_SERVICE(id) 等 |
| 6 | quantity | 数量 | INTEGER |  | √ | 1 | 对于独特的数字图片通常为1，服务或其他未来商品可能允许大于1 |
| 7 | price_at_add | 加入时价格 | NUMERIC(10, 2) |  |  | NULL | 可选：记录商品加入购物车时的价格快照，防止后续价格变动影响购物车显示 |
| 8 | created_at | 添加时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 9 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 10 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true 表示已从购物车移除, false 表示在购物车中 |
| - | chk_cart_user_or_session | 约束检查 | CHECK | (user_id IS NOT NULL AND session_id IS NULL) OR (user_id IS NULL AND session_id IS NOT NULL) OR (is_deleted = TRUE) |  |  | 确保对于未删除的条目，user_id 和 session_id 必须且只能设置一个 |

### **USER_FAVORITES[用户收藏]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | UNIQUE INDEX (active composite), FK -> users(id) | √ |  | 外键 -> USER(id)，用户删除时级联删除收藏. 用户+类型+目标ID 在活动状态下唯一 |
| 3 | favorite_type | 收藏对象类型 | VARCHAR(50) | UNIQUE INDEX (active composite), INDEX (user, type) | √ |  | 如 'image', 'album', 'article', 'photographer' |
| 4 | target_id | 收藏对象ID | BIGINT | UNIQUE INDEX (active composite) | √ |  | 关联的对象表的主键 ID (非外键约束) |
| 5 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 收藏时间 |
| 6 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 (例如，未来可能用于更新收藏备注等) |
| 7 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX, UNIQUE INDEX (active composite) | √ | FALSE | true=已取消收藏, false=正常收藏 |

### **USER_BROWSING_HISTORY[用户浏览历史记录]**

为了与业务埋点表（USER_BEHAVIOR）区分，专门为“足迹”功能保存浏览历史：用于在前端展示最近浏览、支持手动删除、数据分析等。

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | INDEX(user_id, viewed_at)  INDEX(user_id, target_type, target_id) | - |  | 登录用户浏览足迹；与 session_id 二选一（详见约束） |
| 3 | session_id | 匿名会话 ID | VARCHAR(64) | INDEX(session_id, viewed_at) 
INDEX(session_id, target_type, target_id) | - |  | 游客浏览足迹；与 user_id 二选一 |
| 4 | target_type | 浏览对象类型 | VARCHAR(50) | 同上复合索引 | √ |  | 取值示例：image / album / article / event |
| 5 | target_id | 浏览对象 ID | BIGINT | 同上复合索引 | √ |  | 关联的对象表的主键 ID (非外键约束) |
| 6 | viewed_at | 浏览时间 | TIMESTAMPTZ | INDEX (user, time) | √ | CURRENT_TIMESTAMP | 记录浏览发生的时间, 用于排序 |
| 7 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 重新浏览或业务调整时自动刷新（触发器维护） |
| 8 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | true=用户已清除此记录, false=正常记录 |

### **USER_BEHAVIOR [用户行为信息收集]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | INDEX, FK -> users(id) |  | NULL | 外键 -> USER(id)(可为空). 用户删除时设为 NULL (行为匿名化) |
| 3 | session_id | 会话标识符 | VARCHAR(64) | INDEX |  | NULL | 关联匿名用户或同一会话的操作 |
| 4 | behavior_type | 行为类型 | VARCHAR(50) | INDEX | √ |  | 如 'view_image', 'add_to_cart', 'search', 'filter_apply', 'login’ |
| 5 | target_type | 行为对象类型 | VARCHAR(50) | INDEX (with target_id) |  | NULL | 行为作用对象的类型 (如 'image', 'event', 'search_query') |
| 6 | target_id | 行为对象 ID | BIGINT | INDEX (with target_type) |  | NULL | (可能是image_id或image_group_id等) |
| 7 | target_value | 行为对象值 | TEXT |  |  | NULL | 当对象无 ID 时记录具体值 (如搜索关键词) |
| 8 | action_duration | 行为持续时间(毫秒) | INTEGER |  |  | NULL | 记录行为耗时, 单位毫秒 |
| 9 | source_page | 行为来源页面 | TEXT |  |  | NULL | 发生行为的页面 URL 或标识符 |
| 10 | behavior_context | 行为上下文(JSON) | JSONB | INDEX (optional GIN) |  | NULL | 存储设备、浏览器、地理位置(模糊)、活动标签等结构化信息 |
| 11 | ip_address | 用户 IP 地址 | INET |  |  | NULL |  |
| 12 | user_agent | User Agent | TEXT |  |  | NULL | 浏览器或客户端信息 |
| 13 | created_at | 行为发生时间 | TIMESTAMPTZ | INDEX | √ | CURRENT_TIMESTAMP |  |
| 14 | s_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | false=正常日志 (通常不删除, 除非合规要求) |
|  | - | chk_behavior_user_or_session | 约束检查 | CHECK |  |  |  |

### **ORDERS [订单信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | order_no | 订单号 | VARCHAR(64) | UNIQUE INDEX | √ |  | 平台唯一的订单标识符 |
| 3 | user_id | 用户 ID | BIGINT | INDEX, FK -> users(id) | √ |  | 关联下单用户, 不允许删除有订单的用户 (RESTRICT) |
| 4 | total_original_price | 原价合计 | NUMERIC(12, 2) |  | √ | 0.00 | 订单内所有条目原价总和 |
| 5 | total_discount_price | 总优惠金额 | NUMERIC(12, 2) |  | √ | 0.00 | 订单级优惠、优惠券、积分抵扣等总和 |
| 6 | total_final_price | 实际支付金额 | NUMERIC(12, 2) |  | √ | 0.00 | 扣除优惠、使用优惠券等后的最终支付金额 |
| 7 | is_tax_inclusive | 是否含税 | BOOLEAN |  |  | TRUE | 价格含税标记 |
| 8 | tax_rate | 税率(%) | NUMERIC(5,2) |  |  | NULL | 13.00=13% |
| 9 | tax_amount | 税额 | NUMERIC(12,2) |  |  | 0.00 | 订单级税 |
| 10 | status | 订单状态 | SMALLINT | INDEX | √ | 0 | 0=待支付, 1=已支付, 2=处理中, 3=已完成, 4=已取消, 5=退款中, 6=已退款 |
| 11 | pay_method | 支付方式 | VARCHAR(32) | INDEX |  | NULL | 如 'WECHAT_PAY', 'ALIPAY', 'POINTS', 'BALANCE' |
| 12 | payment_gateway | 支付网关 | VARCHAR(32) |  |  | NULL | 如 'WECHAT', 'ALIPAY', 'SYSTEM' (内部支付) |
| 13 | transaction_id | 支付流水号 | VARCHAR(128) | INDEX |  | NULL | 支付网关返回的交易凭证号 |
| 14 | pay_time | 支付时间 | TIMESTAMPTZ | INDEX |  | NULL | 支付成功的时间 |
| 15 | created_at | 下单时间 | TIMESTAMPTZ | INDEX | √ | CURRENT_TIMESTAMP |  |
| 16 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 17 | remark | 订单备注 | TEXT |  |  | NULL | 用户或系统添加的备注 |
| 18 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | false=正常, true=用户或管理员删除 (谨慎使用) |

### **ORDER_ITEMS [订单条目信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | order_id | 订单 ID | BIGINT | INDEX, FK -> orders(id) | √ |  | 关联订单, 订单删除时级联删除条目 |
| 3 | item_type | 商品类型 | VARCHAR(32) | INDEX (with item_id) | √ |  | 如 'IMAGE', 'SERVICE' |
| 4 | item_id | 商品 ID | BIGINT | INDEX (with item_type) | √ |  | 关联的商品表 ID (如 images.id) (非外键约束) |
| 5 | item_group_id | 图片组ID | BIGINT | INDEX |  | NULL | (如有) 关联一个逻辑上的商品组或套餐ID |
| 6 | item_name | 商品名称快照 | VARCHAR(255) |  |  | NULL | 购买时商品的名称 |
| 7 | original_price | 商品原价 | NUMERIC(12, 2) |  | √ | 0.00 | 该商品单个的原价 |
| 8 | discount_price | 折扣后价格 | NUMERIC(12, 2) |  | √ | 0.00 | 单个商品应用独立折扣（如有）后的价格 |
| 9 | final_price | 实际支付价格 | NUMERIC(12, 2) |  | √ | 0.00 | 考虑订单整体优惠分摊后，该条目实际贡献的支付金额 |
| 10 | quantity | 购买数量 | INTEGER |  | √ | 1 | 服务通常为1 |
| 11 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 12 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 13 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | false=正常, true=已删除/退货 (根据业务定义) |

### **ORDER_DISCOUNT_DETAILS**[订单优惠明细]

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | order_id | 订单ID | BIGINT | INDEX, FK -> orders(id) ON DELETE CASCADE | √ |  | 关联订单 |
| 3 | coupon_id | 优惠券/策略ID | BIGINT | INDEX, FK -> coupons(id) ON DELETE RESTRICT |  | NULL | 使用的优惠券或策略ID |
| 4 | user_coupon_id | 用户优惠券ID | BIGINT | INDEX, FK -> user_coupons(id) ON DELETE RESTRICT |  | NULL | 使用的用户领取的优惠券实例ID |
| 5 | scope | 作用层级 | VARCHAR(32) | INDEX | √ | 'ORDER' | 'ORDER'=订单级, ‘GROUP’=组级, 'ITEM'=商品级 |
| 6 | scope_target_id | 层级对象ID | BIGINT | INDEX |  | NULL | 如订单ID、组ID、图片ID，视 scope 决定 |
| 7 | discount_amount | 优惠抵扣金额 | NUMERIC(12, 2) |  | √ | 0.00 | 该优惠实际抵扣的金额 |
| 8 | discount_snapshot | 优惠快照 | JSONB |  |  | NULL | { "name":"组内满3‑50", "rule":"3张‑50", "type": "COUPON" } 运维/客服查单 |
| 9 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 10 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 11 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE |  |

### **COUPONS[优惠策略定义]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | name | 优惠名称 | VARCHAR(255) | INDEX | √ |  | 如 "新人专享20元券", "双十一全场9折" |
| 3 | coupon_type | 优惠券类型 | VARCHAR(32) | INDEX | √ |  | 优惠类型（全局、组内等） |
| 4 | discount_type | 优惠方式 | VARCHAR(32) |  | √ |  | 'PERCENTAGE'=百分比折扣, 'FIXED_AMOUNT'=固定金额减免 |
| 5 | discount_value | 优惠数值 | NUMERIC(10,2) |  | √ | 0.00 | 若为PERCENTAGE则为0.00-1.00 (如0.9表示9折), 若FIXED_AMOUNT则为具体金额 |
| 6 | min_purchase_amount | 最低消费金额 | NUMERIC(12,2) |  |  | 0.00 | 满足此金额才可使用 (0.00表示无门槛) |
| 7 | min_item_quantity | 最低商品件数 | INTEGER |  |  | 0 | 购买商品达到此数量才可使用 (0表示无限制) |
| 8 | max_discount_amount | 最大优惠金额 | NUMERIC(12,2) |  |  | NULL | 百分比折扣时，优惠金额的上限 |
| 9 | total_quantity | 总发行量 | INTEGER |  |  | NULL | NULL表示不限量, 针对需要领取的券 |
| 10 | issued_quantity | 已发行/领取数量 | INTEGER |  | √ | 0 |  |
| 11 | usage_limit_per_user | 每用户可使用/领取次数 | INTEGER |  | √ | 1 |  |
| 12 | coupon_group | 优惠组 | VARCHAR(64) | INDEX |  | NULL | (同组互斥，只取最优或按优先级) |
| 13 | group_priority | 组内优先级 | INTEGER |  |  | 0 | (同组优惠叠加或互斥时的判断依据, 数值大优先) |
| 14 | is_stackable_global | 是否可全局叠加 | BOOLEAN |  | √ | FALSE | (是否允许与其他不同组的优惠叠加) |
| 15 | conditions_json | 复杂条件(JSONB) | JSONB |  |  | NULL | 预留给更复杂的规则,如用户标签、商品属性等 |
| 16 | valid_from | 生效时间 | TIMESTAMPTZ |  |  | NULL | 券或策略的开始有效时间 |
| 17 | valid_until | 失效时间 | TIMESTAMPTZ |  |  | NULL | 券或策略的截止有效时间 (NULL则长期有效) |
| 18 | duration_after_claim | 用户领取后有效时长 | INTERVAL |  |  | NULL | (如 '30 days', '1 month')，领取后基于此计算失效时间 |
| 19 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 20 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 21 | is_active | 是否启用 | BOOLEAN | INDEX | √ | TRUE | 策略是否当前可用 |
| 22 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | FALSE=正常, TRUE=已删除 |

### **USER_COUPONS[用户与优惠关联]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | coupon_id | 优惠策略id | BIGINT | INDEX, FK -> coupons(id) ON DELETE RESTRICT | √ |  | 外键 -> coupons(id) |
| 3 | user_id | 用户id | BIGINT | INDEX, FK -> users(id) ON DELETE CASCADE | √ |  | 外键 -> users(id) |
| 4 | status | 使用状态 | SMALLINT | INDEX | √ | 1 | 0=未激活/待领取, 1=未使用/可用, 2=已使用, 3=已过期, 4=已作废 |
| 5 | claimed_at | 领取/发放时间 | TIMESTAMPTZ | INDEX | √ | CURRENT_TIMESTAMP |  |
| 6 | remaining_uses | 剩余可用次数 | INTEGER |  | √ | 1 | 针对可多次使用的券，默认为1 |
| 7 | version | 乐观锁版本号 | INTEGER |  | √ | 0 | (每次更新时+1, 用于并发控制) |
| 8 | expires_at | 失效时间 | TIMESTAMPTZ | INDEX |  | NULL | （NULL则参考coupon定义的有效期或长期有效） |
| 9 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 记录创建时间 |
| 10 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 11 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | FALSE=正常, TRUE=已删除 |

### **COUPONS_PRODUCT[优惠策略与商品关联]**

用于指定某一优惠策略仅对部分图片生效。

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | coupon_id | 优惠策略id | BIGINT | FK -> coupons(id) ON DELETE CASCADE | √ |  | 外键 -> coupons(id) |
| 3 | rule_type | 规则类型 | VARCHAR(16) |  | √ | 'INCLUDE' | 'INCLUDE'=适用, 'EXCLUDE'=排除 |
| 4 | item_type | 关联类型 | VARCHAR(32) | INDEX | √ |  | 如 'PRODUCT', 'CATEGORY', 'IMAGE_GROUP' (与ORDER_ITEMS中的item_type对应或更广义)
（这里可选择“全部”避免过于麻烦全选所有商品id并逐条写入） |
| 5 | item_id | 关联商品ID | BIGINT | INDEX | √ |  | 对应类型的ID (如 image.id) |
| 6 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 7 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 8 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | FALSE=正常, TRUE=已删除 |

### **COUPON_ISSUANCE_LOGS**[优惠操作记录/数据]

运营人员发放优惠券/执行优惠活动的操作记录

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | coupon_id | 优惠策略ID | BIGINT | INDEX, FK -> coupons(id) | √ |  | 关联的优惠策略 |
| 3 | action_type | 操作类型 | VARCHAR(64) | INDEX | √ |  | 如 'ISSUE_TO_USERS', 'CREATE_CAMPAIGN', 'DEACTIVATE_COUPON' |
| 4 | target_scope_type | 目标范围类型 | VARCHAR(32) |  |  | NULL | 如 'ALL_USERS', 'SPECIFIC_USERS', 'USER_GROUP' |
| 5 | target_scope_details | 目标范围详情 | JSONB |  |  | NULL | 如 {"user_ids": [1,2,3]} 或 {"group_id": 5} |
| 6 | quantity_issued | 发放/生成数量 | INTEGER |  |  | NULL | 总共发放或计划发放的优惠券数量 |
| 7 | quantity_claimed | 领取数量 | INTEGER |  | √ | 0 | 已被领取的数量 (针对需要领取的券) |
| 8 | quantity_used | 使用数量 | INTEGER |  | √ | 0 | 已被使用的数量 |
| 9 | operator_id | 操作员ID | BIGINT | INDEX |  | NULL | 执行操作的管理员/系统用户ID, FK -> admin_users(id) |
| 10 | remarks | 记录备注 | TEXT |  |  | NULL | 操作备注，如活动名称、原因等 |
| 11 | created_at | 创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP |  |
| 12 | updated_at | 更新时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 自动更新触发器 |
| 13 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE |  |

### NOTIFICATIONS[通知消息]

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | title | 通知标题 | VARCHAR(255) |  | √ |  | 简短标题，如“订单已支付” |
| 3 | content | 通知内容 | TEXT |  | √ |  | 富文本支持；提示/说明文字 |
| 4 | notify_type | 通知类型 | VARCHAR(50) | INDEX | √ |  | 系统、交易、运营、客服等 |
| 5 | push_type | 推送方式 | VARCHAR(50) |  | √ | 'system' | 如：system（站内）、sms、email、wx |
| 6 | target_user_id | 目标用户 ID | BIGINT | INDEX, FK -> users(id) |  | NULL | NULL 表示非指定用户 (如广播). 用户删除时设为 NULL |
| 7 | action_url | 动作链接 | TEXT |  |  | NULL | 点击通知后跳转的 URL |
| 8 | send_time | 发送/创建时间 | TIMESTAMPTZ | INDEX | √ | CURRENT_TIMESTAMP | 通知产生或计划发送的时间 |
| 9 | expire_time | 失效时间 | TIMESTAMPTZ |  |  | NULL | 过期后不再展示 |
| 10 | status | 状态 | SMALLINT | INDEX | √ | 0 | 0=草稿/待发送, 1=已发送, 2=已撤回 |
| 11 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX | √ | FALSE | false=正常, true=管理员删除 (归档) |

通知类型建议

| `system` | 系统维护/升级 |
| --- | --- |
| `order` | 支付成功、退款成功 |
| `event` | 活动开赛、报名成功 |
| `image` | 图片已审核、处理完成 |
| `message` | 客服沟通或站内私信 |

### USER_NOTIFICATION_REL[用户与通知关联]

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 主键 | BIGSERIAL | PRIMARY KEY | √ |  | 自增主键 |
| 2 | user_id | 用户 ID | BIGINT | UNIQUE INDEX (active), INDEX (user, status), FK -> users(id) | √ |  | 外键 → USER(id)；用户删除时级联删除关联记录 |
| 3 | notification_id | 通知 ID | BIGINT | UNIQUE INDEX (active), INDEX, FK -> notifications(id) | √ |  | 外键 → NOTIFICATIONS(id)；通知删除时级联删除关联记录 |
| 4 | read_status | 阅读状态 | SMALLINT | INDEX (user, status) | √ | 0 | 0=未读, 1=已读 |
| 5 | read_time | 阅读时间 | TIMESTAMPTZ |  |  | NULL | 标记为已读的时间 |
| 6 | created_at | 关联创建时间 | TIMESTAMPTZ |  | √ | CURRENT_TIMESTAMP | 记录何时将此通知关联给用户 |
| 7 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX, UNIQUE INDEX (active) | √ | FALSE |  |

### **REPORTS[举报信息表]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | user_id | 举报用户ID | INT | INDEX(user_id) | √ |  | 外键 -> USER(id) |
| 3 | target_type | 举报对象类型 | VARCHAR(64) |  | √ |  | 如：image_group、image、user、comment、feedback 等 |
| 4 | target_id | 举报对象ID | INT |  | √ |  | 与 target_type 联合定位目标（不设 FK 便于兼容多表） |
| 5 | report_type | 举报类型 | VARCHAR(64) |  |  |  | 如：肖像权、不当内容、版权问题、骚扰行为 等 |
| 6 | report_content | 举报描述 | TEXT |  |  |  | 举报理由或说明 |
| 7 | status | 处理状态 | TINYINT | INDEX(status) | √ | 0 | 0=未处理，1=处理中，2=处理完毕 |
| 8 | handle_remark | 处理备注 | VARCHAR(255) |  |  |  | 处理意见或说明 |
| 9 | handle_time | 处理时间 | DATETIME |  |  |  |  |
| 10 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 11 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 12 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **FEEDBACK[反馈信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | user_id | 用户id | INT | INDEX(user_id) |  |  | 外键 -> USER(id) |
| 3 | feedback_type | 问题类型 | TINYINT |  |  |  | 如1=意见，2=建议 |
| 4 | feedback_content | 反馈信息正文 | TEXT |  | √ |  |  |
| 5 | status | 处理状态 | TINYINT | INDEX(status) | √ | 0 | (0=未处理,1=处理中,2=已处理等) |
| 6 | contact_number | 联系方式 | VARCHAR(32) |  |  |  |  |
| 7 | create_time | 反馈提交时间 | DATETIME |  | √ | now() |  |
| 8 | update_time | 处理更新时间 | DATETIME |  | √ | now() |  |
| 9 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **SHOOTING_PREVIEWS[拍摄预告]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | worker_id | 摄影师ID | INT | INDEX(worker_id) | √ |  |  |
| 3 | scheduled_start_time | 预定拍摄开始时间 | DATETIME | INDEX((scheduled_start_time, scheduled_end_time)) | √ |  |  |
| 4 | scheduled_end_time | 预定拍摄结束时间 | DATETIME | INDEX((scheduled_start_time, scheduled_end_time)) | √ |  |  |
| 5 | location_id | 拍摄地点 | INT | INDEX(location_id) | √ |  | 外键 -> LOCATION(id) |
| 6 | description | 预告描述信息 | TEXT |  |  |  | 可包含拍摄主题、注意事项等 |
| 7 | create_time | 反馈提交时间 | DATETIME |  | √ | now() |  |
| 8 | update_time | 处理更新时间 | DATETIME |  | √ | now() |  |
| 9 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### PHOTOGRAPHER_PORTFOLIO_REL[摄影师作品关联表]

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | worker_id | 摄影师ID | INT | PRIMARY KEY(worker_id, image_id) | √ |  | 外键 → WORKERS(id) |
| 2 | image_id | 图片ID | INT | PRIMARY KEY(worker_id, image_id) | √ |  | 外键 → IMAGES(id) |
| 3 | sort_order | 排序号 | INT | INDEX |  | 0 | 控制前端展示顺序（越小越靠前） |
| 4 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 5 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 8 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **USER_SETTINGS[ 用户个性化配置]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | user_id | 用户ID | INT | INDEX(user_id) | √ |  |  |
| 3 | config_key | 配置项名称 | VARCHAR(64) | UNIQUE INDEX (user_id, config_key) | √ |  | 如 theme, notification, privacy |
| 4 | config_value | 配置项的值 | TEXT |  | √ |  | 采用 TEXT 类型以支持较长内容 |
| 5 | description |  |  |  |  |  | 配置项说明（可选） |
| 6 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 7 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 8 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **ARTICLES[图文信息]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | title | 文章标题 | VARCHAR(255) |  | √ |  |  |
| 3 | slug | URL标识符 | VARCHAR(128) |  | √ |  | 友好URL标识符，便于 SEO |
| 4 | content | 文章内容 | TEXT |  |  |  | Markdown 格式 |
| 5 | summary | 文章摘要 | VARCHAR(512) |  |  |  | 文章摘要或预览文本 |
| 6 | cover_image | 封面图片路径 | VARCHAR(128) |  |  |  | 封面图片路径 |
| 7 | author_id | 作者id | INT | INDEX(author_id) |  |  | 外键 -> USER(id) 或 WORKERS(id) |
| 8 | published_time | 发布时间 | DATETIME | INDEX(published_time) |  |  |  |
| 9 | status | 文章状态 | TINYINT | INDEX(status) |  | 0 | 状态：0=草稿, 1=已发布 |
| 10 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 11 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 12 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **PHOTOGRAPHER_EARNINGS [摄影师收益流水表]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | worker_id | 摄影师ID | INT | INDEX(worker_id) | √ |  | 外键 -> WORKERS(id) |
| 3 | order_item_id | 订单条目ID | INT | INDEX(order_item_id) | √ |  | 外键 -> ORDER_ITEMS(id) |
| 4 | image_id | 关联图片ID | INT | INDEX(image_id) | √ |  | 外键 -> IMAGES(id) |
| 5 | earning_amount | 收益金额 | DECIMAL(10,2) |  | √ | 0.00 | 该订单条目为摄影师带来的分成金额 |
| 6 | commission_rate | 分成比例 | DECIMAL(5,4) |  | √ | 0.0000 | 结算时使用的分成比例 (如 0.7000) |
| 7 | transaction_time | 交易时间 | DATETIME | INDEX(transaction_time) | √ | now() | 通常是订单支付完成时间 |
| 8 | status | 结算状态 | TINYINT | INDEX(status) | √ | 0 | 0=待结算, 1=已结算(进入可提现), 2=已提现, 3=异常 |
| 9 | remark | 备注 | VARCHAR(255) |  |  |  |  |
| 10 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 11 | update_time | 更新时间 | DATETIME |  | √ | now() |  |

### **PAYOUTS[提现记录表]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | worker_id | 申请人ID | INT |  | √ |  | 外键 -> WORKERS(id) |
| 3 | payout_no | 提现单号 | VARCHAR(64) | UNIQUE INDEX | √ |  | 唯一提现申请编号 |
| 4 | amount | 提现金额 | DECIMAL(10,2) |  | √ | 0.00 |  |
| 5 | fee | 手续费 | DECIMAL(10,2) |  | √ | 0.00 | 平台或支付渠道收取的手续费 |
| 6 | actual_amount | 实际到账金额 | DECIMAL(10,2) |  | √ | 0.00 | amount - fee |
| 7 | payout_method | 提现方式 | VARCHAR(32) |  | √ |  | 如 'BANK_TRANSFER', 'ALIPAY', 'WECHAT' |
| 8 | account_info | 收款账户信息 | TEXT |  | √ |  | 加密存储银行卡号/支付宝账号等 |
| 9 | status | 提现状态 | TINYINT | INDEX(status) | √ | 0 | 0=申请中, 1=处理中, 2=已完成, 3=失败/驳回 |
| 10 | apply_time | 申请时间 | DATETIME | INDEX(apply_time) | √ | now() |  |
| 11 | complete_time | 完成时间 | DATETIME |  |  |  | 提现成功或失败的时间 |
| 12 | transaction_id | 支付平台流水号 | VARCHAR(128) |  |  |  | 转账成功后的外部流水号 |
| 13 | remark | 备注/失败原因 | VARCHAR(255) |  |  |  |  |
| 14 | handled_by | 处理人ID | INT |  |  |  | 外键 -> WORKERS(id), 审核或处理提现的管理员 |
| 15 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 16 | update_time | 更新时间 | DATETIME |  | √ | now() |  |

### **ACTION_LOGS[操作日志]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | action_type | 操作类型 | TINYINT | INDEX(action_type) | √ |  | 如：1=创建、2=更新、3=删除 |
| 3 | action_user | 操作员 | INT | INDEX(action_user) | √ |  | 外键 -> WORKERS(id) |
| 4 | target_table | 操作的表 | VARCHAR(64) | INDEX((target_table, target_id)) | √ |  | 被操作的数据表名称 |
| 5 | target_id | 操作的记录ID | INT | INDEX((target_table, target_id)) | √ |  | 被操作的数据记录的主键ID |
| 6 | action_time | 操作时间 | DATETIME | INDEX(action_time) | √ | now() | 操作发生的具体时间 |
| 7 | remark | 备注 | TEXT |  |  |  | 可记录具体字段变化、IP、操作来源等 |

### **ERROR_LOGS[**错误日志**]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | error_code | 错误代码 | VARCHAR(64) |  |  |  | 自定义错误码，如 E1001 |
| 3 | error_message | 错误消息 | TEXT |  | √ |  | 简要错误描述 |
| 4 | error_stack | 错误堆栈 | TEXT |  | √ |  | 异常堆栈详情 |
| 5 | error_time | 发生时间 | DATETIME |  | √ | now() |  |
| 6 | is_resolved | 是否已解决 | BOOLEAN | INDEX(is_resolved) | √ | 0 | (0=未解决) |

### **LOGIN_LOGS[登录日志]**

记录用户或工作人员登录行为，含IP、设备信息、登录状态等。

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | user_type | 用户类型 | TINYINT | INDEX | √ |  | 1=用户，2=工作人员等 |
| 3 | user_id | 用户ID | INT | INDEX | √ |  | 对应 USER 或 WORKERS 表 |
| 4 | login_result | 登录结果 | TINYINT | INDEX | √ | 1 | 1=成功，0=失败 |
| 5 | login_method | 登录方式 | VARCHAR(32) |  |  |  | 如手机号、验证码、微信、小程序等 |
| 6 | ip_address | 登录IP地址 | VARCHAR(45) |  |  |  | IPV4或IPV6 |
| 7 | user_agent | 客户端信息 | VARCHAR(255) |  |  |  | 浏览器/设备类型 |
| 8 | login_time | 登录时间 | DATETIME | INDEX | √ | now() |  |
| 9 | remark | 备注 | VARCHAR(255) |  |  |  | 如失败原因 |
| 10 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |

### **API_LOGS[接口请求日志]**

记录服务端所有接口调用情况，便于追踪接口异常、性能瓶颈。

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | endpoint | 接口路径 | VARCHAR(255) | INDEX | √ |  | 如 `/api/image/upload` |
| 3 | method | 请求方式 | VARCHAR(8) |  | √ |  | GET / POST / PUT / DELETE |
| 4 | status_code | 响应状态码 | INT | INDEX | √ | 200 | 如 200, 401, 500 |
| 5 | response_time | 响应耗时(ms) | INT |  | √ |  | 单位：毫秒 |
| 6 | user_type | 用户类型 | VARCHAR(16) |  |  |  | user / worker / anonymous |
| 7 | user_id | 用户ID | INT | INDEX |  |  | 若登录用户存在则记录 |
| 8 | request_payload | 请求体摘要 | TEXT |  |  |  | 可存部分敏感脱敏内容 |
| 9 | response_message | 响应内容摘要 | TEXT |  |  |  | 记录返回信息（如失败原因） |
| 10 | request_ip | 请求IP地址 | VARCHAR(45) |  |  |  | IPV4或IPV6 |
| 11 | user_agent | 客户端信息 | VARCHAR(255) |  |  |  |  |
| 12 | request_time | 请求时间 | DATETIME | INDEX | √ | now() |  |

### **OPERATION_AUDIT[字段级变更审计日志]**

用于记录敏感字段的变更行为，例如修改了订单金额、用户状态等。

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | module_name | 模块名称 | VARCHAR(64) | INDEX | √ |  | 如：ORDER、USER、IMAGE |
| 3 | record_id | 记录ID | INT | INDEX | √ |  | 被修改的数据ID |
| 4 | field_name | 字段名称 | VARCHAR(64) |  | √ |  | 被修改的字段名称 |
| 5 | old_value | 修改前值 | TEXT |  |  |  |  |
| 6 | new_value | 修改后值 | TEXT |  |  |  |  |
| 7 | change_reason | 修改原因 | VARCHAR(255) |  |  |  | 人工填写或系统说明 |
| 8 | operator_id | 操作人ID | INT | INDEX | √ |  | 外键 -> WORKERS(id) |
| 9 | operate_time | 修改时间 | DATETIME | INDEX | √ | now() |  |

### **SMS_LOGS[短信/验证码发送日志]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | phone_number | 手机号 | VARCHAR(32) | INDEX | √ |  |  |
| 3 | template_type | 短信类型 | VARCHAR(32) | INDEX | √ |  | login / reset / verify 等 |
| 4 | content | 短信内容 | TEXT |  | √ |  | 实际发送内容（建议脱敏） |
| 5 | send_status | 发送状态 | TINYINT | INDEX | √ | 0 | 0=未发送，1=已发送，2=失败 |
| 6 | fail_reason | 失败原因 | VARCHAR(255) |  |  |  | 第三方接口返回错误消息 |
| 7 | ip_address | 请求IP | VARCHAR(45) |  |  |  | 防止同IP频繁请求 |
| 8 | user_agent | UA信息 | VARCHAR(255) |  |  |  | 可用于风控判断 |
| 9 | send_time | 发送时间 | DATETIME | INDEX | √ | now() |  |

### **TASK_EXECUTION_LOGS[定时任务执行日志]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | task_name | 任务名称 | VARCHAR(128) | INDEX | √ |  | 如：清理过期订单、自动打水印等 |
| 3 | task_type | 任务类型 | VARCHAR(64) | INDEX | √ |  | cron / interval / manual |
| 4 | trigger_time | 触发时间 | DATETIME | INDEX | √ | now() | 实际开始时间 |
| 5 | end_time | 结束时间 | DATETIME |  |  |  | 可计算耗时 |
| 6 | status | 执行状态 | TINYINT | INDEX | √ | 0 | 0=未执行,1=成功,2=失败 |
| 7 | result | 执行结果摘要 | TEXT |  |  |  | 可记录执行记录、错误内容等 |
| 8 | remark | 备注 | VARCHAR(255) |  |  |  |  |

### **ORDER_LOGS[订单操作日志]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | order_id | 订单ID | INT | INDEX | √ |  | 外键 -> ORDERS(id) |
| 3 | action_type | 操作类型 | VARCHAR(32) | INDEX | √ |  | 状态变更/退款/回调/金额改动等 |
| 4 | previous_status | 变更前状态 | TINYINT |  |  |  |  |
| 5 | new_status | 变更后状态 | TINYINT |  |  |  |  |
| 6 | changed_by | 操作人ID | INT |  |  |  | user_id 或 operator_id（系统操作可为NULL） |
| 7 | actor_type | 操作者类型 | VARCHAR(16) |  |  | 'user'/'worker'/'system' |  |
| 8 | description | 操作说明 | TEXT |  |  |  | 回调内容 / 手动修改说明等 |
| 9 | action_time | 操作时间 | DATETIME | INDEX | √ | now() |  |

### **SYSTEM_CONFIG[系统配置表]**

| / | 字段 | 名称 | 数据类型 | 主键/索引 | 非空 | 默认值 | 备注 |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | id | 唯一标识符 | INT AUTO_INCREMENT | PRIMARY_KEY | √ |  |  |
| 2 | config_key | 配置键 | VARCHAR(128) | UNIQUE INDEX(config_key, is_deleted) | √ |  | 唯一配置项标识，如 'platform_commission_rate', 'default_image_price', 'wechat_app_id' |
| 3 | config_value | 配置值 | TEXT |  | √ |  | 存储配置的值 |
| 4 | description | 配置描述 | VARCHAR(255) |  |  |  | 说明该配置项的用途 |
| 5 | group_name | 配置分组 | VARCHAR(64) | INDEX |  | 'default' | 用于后台界面分组展示，如 'Payment', 'Storage', 'Notification' |
| 6 | is_public | 是否公开 | BOOLEAN |  | √ | 0 | 标记某些配置是否可以暴露给前端 (慎用) |
| 7 | create_time | 创建时间 | DATETIME |  | √ | now() |  |
| 8 | update_time | 更新时间 | DATETIME |  | √ | now() |  |
| 9 | is_deleted | 逻辑删除标记 | BOOLEAN | INDEX(is_deleted) | √ | 0 | (0=正常) |